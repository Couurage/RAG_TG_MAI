# RAG-TG-MAI

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –≤–ø–µ—á–∞—Ç–ª—è—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞, –Ω–æ —É –Ω–∏—Ö –µ—Å—Ç—å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∏–∑—ä—è–Ω:  
–º–æ–¥–µ–ª—å **–Ω–µ –∑–Ω–∞–µ—Ç —Ç–æ–≥–æ, —á–µ–≥–æ –Ω–µ –≤–∏–¥–µ–ª–∞ –Ω–∞ –æ–±—É—á–µ–Ω–∏–∏** –∏ –ª–µ–≥–∫–æ –ø—Ä–∏–¥—É–º—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç—ã.  
–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –ª–µ–∫—Ü–∏—è–º–∏, –º–µ—Ç–æ–¥–∏—á–∫–∞–º–∏, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ ‚Äî –æ–±—ã—á–Ω–∞—è LLM –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω–∞.  

–ó–¥–µ—Å—å –ø–æ—è–≤–ª—è–µ—Ç—Å—è **RAG (Retrieval-Augmented Generation)** ‚Äî –ø–æ–¥—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–µ–¥–∏–Ω—è–µ—Ç —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –¥–≤—É—Ö –º–∏—Ä–æ–≤:  
1) —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –≤ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –±–∞–∑–µ,  
2) –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤.

RAG –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–µ–ª–∏ –Ω–µ "—É–≥–∞–¥—ã–≤–∞—Ç—å", –∞ –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.  
–¢—ã –∑–∞–¥–∞—ë—à—å –≤–æ–ø—Ä–æ—Å ‚Üí —Å–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç –Ω—É–∂–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ ‚Üí —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Üí LLM —Å–æ–∑–¥–∞—ë—Ç —Ç–æ—á–Ω—ã–π, –∞—Ä–≥—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç.

**RAG_TG_MAI** ‚Äî —ç—Ç–æ –ø—Ä–æ–µ–∫—Ç –ø–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é —Ç–∞–∫–æ–π —Å–∏—Å—Ç–µ–º—ã.  
–í –Ω—ë–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª:  
- –∑–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤, –ª–µ–∫—Ü–∏–π, –º–µ—Ç–æ–¥–∏—á–µ–∫),  
- –Ω–∞—Ä–µ–∑–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —á–∞–Ω–∫–∏,  
- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ Gemma,  
- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Ö –≤ Milvus,  
- –ø–æ–∏—Å–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É,  
- –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ LLM –∏ Telegram-–±–æ—Ç.

---
# –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

![RAG_test](images/RAG_test.gif)

---

## üß± –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- Python 3.12, FastAPI, httpx
- Aiogram 3 (Telegram-–±–æ—Ç)
- HuggingFace Transformers + `unsloth/embeddinggemma-300m-qat-q8_0-unquantized`
- Milvus Standalone (pymilvus)
- Docker / docker compose
- LLM-–∫–ª–∏–µ–Ω—Ç: GigaChat (`GIGACHAT_BASIC` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
backend/
  gemma_services/      
  database/milvus.py   
  utils/               
bot/                   
main.py                
docker-compose.yml
Dockerfile
.env.example
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker)

1. –ö–ª–æ–Ω –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
```bash
git clone https://github.com/Couurage/RAG_TG_MAI.git
cd RAG_TG_MAI
cp .env.example .env
mkdir -p data_md volumes/hf_cache
```

2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å `.env`:
```
GIGACHAT_BASIC=...               # –∫–ª—é—á –¥–ª—è LLM
RAG_API_BASE=http://rag_api:8000 # –¥–ª—è –±–æ—Ç–∞ –≤ docker-compose
TELEGRAM_BOT_TOKEN=...           # –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –±–æ—Ç
```

3. –ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ —Å—Ç–µ–∫–∞:
```bash
docker compose up -d --build
```
–ü–µ—Ä–≤—ã–π —Å—Ç–∞—Ä—Ç –∫–∞—á–∞–µ—Ç –º–æ–¥–µ–ª—å (~1 –º–∏–Ω). –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö `rag_api`.

4. –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
docker compose ps
docker compose logs -f rag_api   
curl http://localhost:8000/health
```

## üñ• –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)
```bash
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt
# –∑–∞–ø—É—Å—Ç–∏ Milvus –æ—Ç–¥–µ–ª—å–Ω–æ –∏–ª–∏ —á–µ—Ä–µ–∑ docker-compose standalone
export MILVUS_HOST=localhost MILVUS_PORT=19530
python main.py        # FastAPI
python -m bot.main    # –±–æ—Ç (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
```
–î–ª—è –±–æ—Ç–∞ –≤ `.env`: `RAG_API_BASE=http://localhost:8000`.

---

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –î–æ–∫—É–º–µ–Ω—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ Markdown, —Ä–µ–∂–µ—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏ —Ç–æ–∫–µ–Ω–∞–π–∑–µ—Ä–æ–º.  
2. –ö–∞–∂–¥—ã–π —á–∞–Ω–∫ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —ç–º–±–µ–¥–¥–∏–Ω–≥ Gemma.  
3. –í–µ–∫—Ç–æ—Ä–∞ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ Milvus (doc_id, chunk_id, section, owner_id).  
4. –ó–∞–ø—Ä–æ—Å —Ç–æ–∂–µ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä, Milvus –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–ª–∏–∂–∞–π—à–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.  
5. LLM (GigaChat) —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.  

---

## ‚ÑπÔ∏è –ü–æ–ª–µ–∑–Ω–æ–µ
- –ö—ç—à –º–æ–¥–µ–ª–∏ (gemma): `volumes/hf_cache`.
- –î–∞–Ω–Ω—ã–µ Milvus: `volumes/milvus`. –£–¥–∞–ª–µ–Ω–∏–µ –æ—á–∏—â–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã.
- –ü–æ–ª–Ω—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç: `docker compose down --remove-orphans` ‚Üí (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `rm -rf volumes/milvus`) ‚Üí `docker compose up -d --build`.
- –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∏–∑–Ω—É—Ç—Ä–∏: `docker exec -i rag-api curl -s http://127.0.0.1:8000/health`.
- –û—à–∏–±–∫–∞ `Name or service not known` —É –±–æ—Ç–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—å `RAG_API_BASE` –∏ DNS/–¥–æ—Å—Ç—É–ø –∫ `api.telegram.org` (–≤ compose –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `dns:` –∏–ª–∏ –∑–∞–¥–∞—Ç—å –ø—Ä–æ–∫—Å–∏).
